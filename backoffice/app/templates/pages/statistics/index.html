{% extends "layouts/base.html" %}
{% block content %}

<!-- INFO INICIAL -->
            <p>A continuación te mostramos algunos datos de interés calculados según tus preferencias. Puedes ver o modificar tus ajustes en <strong><a class="text-d-underline" href="#" data-bs-target="#box_1" data-bs-toggle="modal">pinchando aquí</a></strong>.</p>

<!-- / INFO INICIAL -->


<!-- CARDS GLOBAL -->
 <div class="row">
  <div class="col-md-12">
    <div class="card equal-card">
      <div class="card-body">
        <!-- global -->
        <div class="row">
          <div class="col-sm-12">
            <h5 class="header-title-text">Resumen del inventario global de propiedades</h5>

            <div class="project-status-box">

              <div class="project-status-card bg-light">
                <span class="bg-light-dark h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-house-line"></i>
                </span>
                <p class="mb-0 mt-2">Inmuebles en cartera</p>
                <h4 class="text-white f-w-600">{{ '{:,.0f}'.format(kpi.card01 | float).replace(',', '.') }}</h4>
              </div>

              <div class="project-status-card bg-light">
                <span class="bg-light-dark h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-align-center-horizontal"></i>
                </span>
                <p class="mb-0 mt-2">Repartidas en distritos</p>
                <h4 class="text-white f-w-600">{{ '{:,.0f}'.format(kpi.card02 | float).replace(',', '.') }}</h4>
              </div>
    
              <div class="project-status-card bg-light">
                <span class="bg-light-dark h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-currency-eur"></i>
                </span>
                <p class="mb-0 mt-2">Precio medio</p>
                <h4 class="text-white f-w-600">{{ '{:,.2f}'.format(kpi.card03 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }}€</h4>
              </div>

              <div class="project-status-card bg-light">
                <span class="bg-light-dark h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-bold  ph-hand-coins"></i>
                </span>
                <p class="mb-0 mt-2">Inmuebles rentables</p>
                <h4 class="f-w-600 text-white">{{ '{:,.2f}'.format(kpi.card04 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }} %</h4>
              </div>


              <div class="project-status-card bg-light">
                <span class="bg-light-dark h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-arrow-circle-up-right"></i>
                </span>
                <p class="mb-0 mt-2">Retorno Anual medio</p>
                <h4 class="f-w-600 text-white">{{ '{:,.2f}'.format(kpi.card05 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }} %</h4>
              </div>

              <div class="project-status-card bg-light">
                <span class="bg-light-dark h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-bold  ph-arrows-clockwise"></i>
                </span>
                <p class="mb-0 mt-2">Ganancia anual media</p>
                <h4 class="text-white f-w-600">{{ '{:,.2f}'.format(kpi.card06 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }}€</h4>
              </div>

            </div>


          </div>

        </div>
        <!-- / global -->
        <!-- custom -->
        <div class="row mt-3">
          <div class="col-sm-12">
            <h5 class="header-title-text">Resumen personalizado del inventario <span class="f-fs-italic">(de acuerdo a tus preferencias y ajustes)</span></h5>

            <div class="project-status-box">

              <div class="project-status-card bg-light-primary">
                <span class="bg-primary h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-house-line"></i>
                </span>
                <p class="mb-0 mt-2">Inmuebles en cartera</p>
                <h4 class="text-primary f-w-600">{{ '{:,.0f}'.format(kpi.card11 | float).replace(',', '.') }}</h4>
              </div>

              <div class="project-status-card bg-light-primary">
                <span class="bg-primary h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-align-center-horizontal"></i>
                </span>
                <p class="mb-0 mt-2">Repartidas en distritos</p>
                <h4 class="text-primary f-w-600">{{ '{:,.0f}'.format(kpi.card12 | float).replace(',', '.') }}</h4>
              </div>

              <div class="project-status-card bg-light-primary">
                <span class="bg-primary h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-currency-eur"></i>
                </span>
                <p class="mb-0 mt-2">Precio medio</p>
                <h4 class="text-primary f-w-600">{{ '{:,.2f}'.format(kpi.card13 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }}€</h4>
              </div>

              <div class="project-status-card bg-light-primary">
                <span class="bg-primary h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-bold  ph-hand-coins"></i>
                </span>
                <p class="mb-0 mt-2">Inmuebles rentables</p>
                <h4 class="f-w-600 text-primary">{{ '{:,.2f}'.format(kpi.card14 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }} %</h4>
              </div>


              <div class="project-status-card bg-light-primary">
                <span class="bg-primary h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-fill  ph-arrow-circle-up-right"></i>
                </span>
                <p class="mb-0 mt-2">Retorno Anual medio</p>
                <h4 class="f-w-600 text-primary">{{ '{:,.2f}'.format(kpi.card15 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }} %</h4>
              </div>

              <div class="project-status-card bg-light-primary">
                <span class="bg-primary h-45 w-45 d-flex-center b-r-50">
                  <i class="ph-bold  ph-arrows-clockwise"></i>
                </span>
                <p class="mb-0 mt-2">Ganancia anual media</p>
                <h4 class="text-primary f-w-600">{{ '{:,.2f}'.format(kpi.card16 | float).replace(',', 'X').replace('.', ',').replace('X', '.') }}€</h4>
              </div>

            </div>


          </div>

        </div>
        <!-- / custom -->
      </div>
    </div>
  </div>
</div>
<!-- / CARDS GLOBAL -->

<!-- barras según rentabilidad general y XXXX -->
<div class="row">


  <div class="col-sm-6  d-flex align-items-stretch">
    <div class="card w-100">
      <div class="card-header">
        <h5>Composición según retorno de tus inmuebles objetivo</h5>
      </div>
      <div class="card-body">
        <div id="composition_by_roi_div"></div>
      </div>
    </div>
  </div>

  <div class="col-sm-6  d-flex align-items-stretch">
    <div class="card w-100">
      <div class="card-header">
        <h5>Comparativa multivariable por nivel de rentabilidad</h5>
      </div>
      <div class="card-body">
        <div id="radar2"></div>
      </div>
    </div>
  </div>




</div>


<!-- / barras según rentabilidad general y XXXX -->




<!-- Barras apiladas por distritos -->
<div class="row">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header">
        <h5>Rentabilidad de los inmuebles por distrito <span class="f-fs-italic">(de acuerdo a tus preferencias y ajustes)</span></h5>
      </div>
      <div class="card-body">
        <div id="column3"></div>
      </div>
    </div>
  </div>
</div>
<!-- / Barras apiladas por distritos -->

<!-- Dispersión de Rentabilidad -->
<div class="row">

  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5>Dispersión de Rentabilidad según el Precio de Compra <span class="f-fs-italic">(de acuerdo a tus preferencias y ajustes)</span></h5>
      </div>
      <div class="card-body">
        <div id="scatter1"></div>
      </div>
    </div>
  </div>

</div>
<!-- / Dispersión de Rentabilidad -->

<!-- Dispersión de Ganancias anuales -->
<div class="row">

  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5>Dispersión de Ganancias anuales según el Precio de Compra y la estimación de ocupación anual <span class="f-fs-italic">(de acuerdo a tus preferencias y ajustes)</span></h5>
      </div>
      <div class="card-body">
        <div id="scatter2"></div>
      </div>
    </div>
  </div>

</div>
<!-- / Dispersión de Ganancias anuales -->





<!-- grafico de barras apiladas -->
<script>
  const chartData = {{ houses_by_distrito | safe }};
</script>
<script>
var options = {
  series: chartData.series,
  chart: {
    type: 'bar',
    height: 350,
    stacked: true,
    toolbar: { show: true },
    zoom: { enabled: true }
  },
  responsive: [{
    breakpoint: 480,
    options: {
      legend: { position: 'bottom', offsetX: -10, offsetY: 0 }
    }
  }],
  plotOptions: {
    bar: {
      horizontal: false,
      borderRadius: 10,
      dataLabels: {
        total: {
          enabled: true,
          style: { fontSize: '13px', fontWeight: 900 }
        }
      }
    }
  },
  xaxis: { categories: chartData.categories },
  legend: { position: 'right', offsetY: 40 },
  fill: { opacity: 1 },
  colors: chartData.colors
};

var chart = new ApexCharts(document.querySelector("#column3"), options);
chart.render();
</script>
<!-- / grafico de barras apiladas -->


<!-- scatter plot -->
<script>  
 const scatter_series = {{ scatter_data | safe }};

    const scatter_options = {
    series: scatter_series,
      chart: {
        height: 500,
        type: 'scatter',
        zoom: { enabled: true, type: 'xy' }
      },
      // No definimos colors[]: cada punto usa su propio `fillColor`
      markers: { size: 6 },
      xaxis: {
        title: { text: 'Precio de compra (€)' },
        tickAmount: 10,
        labels: {
          formatter: v => Intl.NumberFormat("es-ES",
                          { notation: "compact", maximumFractionDigits: 1 }).format(v)
        }
      },
      yaxis: {
        title: { text: 'Rentabilidad (%)' },
        tickAmount: 8,
        labels: { formatter: v => v.toFixed(1) + '%' }
      },
      tooltip: {
        x: { formatter: v => '€ ' + v.toLocaleString('es-ES') },
        y: { formatter: v => v.toFixed(2) + ' %' }
      }
    };

    new ApexCharts(document.querySelector("#scatter1"), scatter_options).render();

  
</script>
<!-- / scatter plot -->

<!-- scatter_2 plot -->
<script>  
 const scatter_2_series = {{ scatter_2_data | safe }};

    const scatter_2_options = {
    series: scatter_2_series,
      chart: {
        height: 500,
        type: 'scatter',
        zoom: { enabled: true, type: 'xy' }
      },
      // No definimos colors[]: cada punto usa su propio `fillColor`
      markers: { size: 6 },
      xaxis: {
        title: { text: 'Precio de compra (€)' },
        tickAmount: 10,
        labels: {
          formatter: v => Intl.NumberFormat("es-ES",
                          { notation: "compact", maximumFractionDigits: 1 }).format(v)
        }
      },
      yaxis: {
        title: { text: 'Ganancias Anuales Netas (Eur)' },
        tickAmount: 8,
        labels: { formatter: v => v.toFixed(1) + '€' }
      },
      tooltip: {
        x: { formatter: v => '€ ' + v.toLocaleString('es-ES') },
        y: { formatter: v => v.toFixed(2) + ' €' }
      }
    };

    new ApexCharts(document.querySelector("#scatter2"), scatter_2_options).render();

  
</script>
<!-- / scatter_2 plot -->


<!-- donut según rentabilidad general -->
<script>
  var donut_roi_options = {
    series: {{ donut_data.values_json | safe }},
    labels: {{ donut_data.labels_json | safe }},
    chart: {
        type: 'donut',
        height: 350,
    },
    legend: {
      position: 'bottom'
    },
    colors: {{ donut_data.colors_json | safe }},
    responsive: [{
      breakpoint: 1366,
      options: {
          chart: {
              height: 350
          },
          legend: {
            show: false
          }
      }
    }]
  };

  var chart = new ApexCharts(document.querySelector("#composition_by_roi_div"), donut_roi_options);
  chart.render();
</script>

<!-- / donut según rentabilidad general  -->


<!-- radar2 -->
<script>
  var radar_2_options = {
    series: {{ radar_2_data.series_json | safe }},
    chart: {
      height: 350,
      type: 'radar',
      dropShadow: {
        enabled: true,
        blur: 1,
        left: 1,
        top: 1
      }
    },
    stroke: {
      width: 2
    },
    fill: {
      opacity: 0.1
    },
    markers: {
      size: 0
    },
    xaxis: {
      categories: {{ radar_2_data.categories_json | safe }}
    },
    colors: {{ radar_2_data.colors_json | safe }}
  };

  var chart = new ApexCharts(document.querySelector("#radar2"), radar_2_options);
  chart.render();
</script>
<!-- / radar2 -->





<!-- MODAL-start-->
<div class="modal fade" id="box_1" aria-hidden="true" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary ">
        <h5 class="modal-title text-white" id="exampleModalToggleLabel4">Tus ajustes</h5>
        <button type="button" class="btn-close m-0 fs-5" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Todos los datos expuestos han sido calculados conforme a los siguientes ajustes. Recuerda que puedes cambiarlos en cualquier momento pulsando en el botón personalizar.</p>
        <ul>
           
          <li><i class="ti ti-coin-euro icon-bg"></i> Presupuesto máximo: <b>{{ '{:,.0f}'.format(parameters.MAX_INVESTMENT_BUDGET.VALUE | float).replace(',', '.') }} €</b></li>
          <li><i class="ti ti-coins icon-bg"></i> Retorno garantizado: <b>{{ '{:,.0f}'.format(parameters.INITIAL_MIN_ROI_DISPLAY_THRESOLD.VALUE | float).replace(',', '.') }} %</b></li>
          <li><i class="ti ti-building-warehouse icon-bg"></i> Ocupación anual: <b>{{ '{:,.0f}'.format(parameters.ESTIMATED_ANNUAL_OCCUPANCY.VALUE | float).replace(',', '.') }} %</b></li>
          <li><i class="ti ti-file-spreadsheet icon-bg"></i> Gastos aplicables a la compra: <b>{{ '{:,.0f}'.format(parameters.PURCHASE_COST.VALUE | float).replace(',', '.') }} %</b></li>
          <li><i class="ti ti-award icon-bg"></i> Gastos fijos: <b>{{ '{:,.0f}'.format(parameters.FIXED_OPEX.VALUE | float).replace(',', '.') }} %</b></li>
          <li><i class="ti ti-bulb-filled icon-bg"></i> Gastos variables: <b>{{ '{:,.0f}'.format(parameters.VARIABLE_OPEX.VALUE | float).replace(',', '.') }} %</b></li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button"
          onclick="window.open('{{ url_for('custom_controller.index') }}',location='_self')" class="btn btn-light-secondary">Personalizar</button>
        <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL-end-->

{% endblock %}
{% extends "layouts/base.html" %}


{% block content %}



<!-- Área de búsqueda -->
<div class="row mb-3" id="acordeon">
  <div class="col-12">
    <div class="card-body">
      <div class="accordion app-accordion accordion-primary">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#filter_area"
              aria-expanded="true" aria-controls="filter_area">
                Personaliza y filtra las oportunidades de inversión inmobiliaria
            </button>
          </h2>
          <div id="filter_area" class="accordion-collapse collapse show" data-bs-parent="#acordeon">
            <div class="accordion-body">
              <!-- filter_form -->
              <form class="app-form">
                <div class="row">
                  <div class="col-12 mb-2">
                    <p>Descubre las mejores oportunidades de inversión personalizando tus filtros de búsqueda y encuentra las
                      propiedades que mejor se adaptan a tus objetivos.</p>
                  </div>
                  <div class="col-sm-6">
                    <div class="mb-3">
                      <label class="form-label">Que incluyan el siguiente texto</label>
                      <input type="ftr_text" class="form-control" placeholder="Introduzca un texto">
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="mb-3">
                      <label class="form-label">Distrito</label>
                      <select class="form-select">
                        <option selected>Incluir Todos</option>
                        {% for district in districts %}
                        <option value="{{ district.DISTRITO }}">{{ district.DISTRITO }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
              
                  <div class="col-sm-6 ">
                    <div>
                      <label class="form-label mb-3" style="padding-bottom:25px">Precio de compra</label>
                      <div class="mt-3" id="buy_price-slider"></div>
                      <input type="hidden" id="buy_price-min">
                      <input type="hidden" id="buy_price-max">
                      <span id="buy_price-display"></span>
                    </div>
                  </div>
              
              
              
                </div>
              
              </form>
              <!-- /filter_form -->
            
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- /Área de búsqueda -->

            
            <!-- Data Table start -->
            <div class="row">
                <!-- Default Datatable start -->
                <div class="col-12">
                  <div class="card ">
                    <!-- <div class="card-header">
                      <h5>Card Title</h5>
                      <p>DataTables has most features enabled by default, so all you need to do to use it with your own
                        tables is to call the construction function: <code>$().DataTable();</code>. </p>
                    </div> -->
                    <div class="card-body p-0">
                      <div class="app-datatable-default overflow-auto">
                        <table id="tablelist" class="display app-data-table default-data-table">
                          <thead>
                            <tr>
                              <th>Id</th>
                              <th>Distrito</th>
                              <th>Título</th>
                              <th>Precio Compra</th>
                              <th>Superficie</th>
                              <th>Visitar</th>
                              <th>Eur / Noche</th>
                              <th>Facturación Anual Estimada</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Default Datatable end -->
                
              </div>
              <!-- Data Table end -->



<script>
  $(document).ready(function () {
    $('#tablelist').DataTable({
      processing: true,
      serverSide: true,
      ajax: '{{url_for("idealista_controller.datalist")}}',
      language: {
        url: "/static/lang/datatables_es-ES.json",
        type: "POST"
      },
      columns: [
        { data: 'id' },
        { data: 'DISTRITO' },
        { data: 'title' },
        { 
          data: 'price',
            render: function (data, type, row) {
            if (data == null) return '';
            let number = Number(data);
            if (isNaN(number)) return data;
            return number.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
            }
        },
        { data: 'built_area' },
        { data: 'link',
          render: function (data, type, row) {
            return '<a type="button" class="btn btn-light-primary icon-btn b-r-4" href="' + data + '" target="_blank"><i class="ti ti-hand-click"></i></a>';
          }
         },
        { data: 'PRICE_PER_NIGHT',
            render: function (data, type, row) {
            if (data == null) return '';
            let number = Number(data);
            if (isNaN(number)) return data;
            return number.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
            }
         },
        { data: 'revenue',
            render: function (data, type, row) {
            if (data == null) return '';
            let number = Number(data);
            if (isNaN(number)) return data;
            return number.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
            }
         },


      ]
    });




  const slider = document.getElementById('buy_price-slider');

  noUiSlider.create(slider, {
    start: [0, {{ max_inv_budget}}],
    connect: true,
    range: {
      'min': 0,
      'max': {{ max_price }}
    },
    tooltips: true,
    format: {
      to: value => Math.round(value) + ' €',
      from: value => Number(value.replace(' €', ''))
    }
  });

  slider.noUiSlider.on('update', function (values, handle) {
    const min = values[0].replace(' €', '');
    const max = values[1].replace(' €', '');
    document.getElementById('buy_price-min').value = min;
    document.getElementById('buy_price-max').value = max;
    // Formatear con separador de miles
    const minFormatted = Number(min).toLocaleString('es-ES');
    const maxFormatted = Number(max).toLocaleString('es-ES');
    document.getElementById('buy_price-display').innerText = `De ${minFormatted} € a ${maxFormatted} €`;
  });



  });







</script>

              {% endblock %}  


